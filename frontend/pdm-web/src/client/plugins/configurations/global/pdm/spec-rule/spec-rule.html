<div class="spec-rule-container">
    <div class="spec-rule-header clearfix">
        <div class="fab-selector">
            <label for="plant">Fab</label>
            <select class="form-control" [(ngModel)]="selectedPlant" (ngModelChange)="changeSelectedPlant($event)">
                <option *ngFor="let plant of plants" [ngValue]="plant" [selected]="plant.fabId === selectedPlant.fabId">
                    {{plant.fabName}}
                </option>
            </select>
        </div>
        <div class="model-seletor">
            <label for="model">Model</label>
            <select class="form-control" [(ngModel)]="selectedModel" (ngModelChange)="changeSelectedModel($event)">
                <option *ngFor="let model of models" [ngValue]="model" [selected]="model.model_name === selectedModel.model_name">
                    {{model.model_name}}
                </option>
            </select>
        </div>
        <div class="btn-group">
            <button class="btn btn-default" type="button" (click)="controlRule(STATUS.DELETE)">Delete</button>
            <button class="btn btn-default" type="button" (click)="controlRule(STATUS.MODIFY)" [disabled]="!rules?.length">Modify</button>
            <button class="btn btn-default" type="button" (click)="controlRule(STATUS.CREATE)">Create</button>
        </div>
    </div>
    <div class="spec-rule-content">
        <div class="rule-list">
            <wj-flex-grid #RuleGrid 
                [itemsSource]="rules" 
                [allowDragging]="'None'" 
                [isReadOnly]="true" 
                [selectionMode]="'Row'" 
                [headersVisibility]="'Column'"
                (selectionChanged)="selectRule(RuleGrid)">
                <!-- <wj-flex-grid-filter #filter></wj-flex-grid-filter> -->
                <wj-flex-grid-column [width]="'*'" [header]="'Rule Name'" [binding]="'rule_name'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Condition'" [binding]="'expression'" [align]="'center'"></wj-flex-grid-column>
            </wj-flex-grid>
        </div>
        <div class="parameter-list">
            <wj-flex-grid
                [itemsSource]="paramsBySelectedRule"
                [allowDragging]="'None'" 
                [isReadOnly]="true"
                [selectionMode]="'Row'" 
                [headersVisibility]="'Column'">
                <!-- <wj-flex-grid-filter #filter></wj-flex-grid-filter> -->
                <wj-flex-grid-column [width]="'*'" [header]="'Parameter'" [binding]="'param_name'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Alarm'" [binding]="'upper_alarm_spec'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Warning'" [binding]="'upper_warning_spec'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Used'" [binding]="'used_yn'" [align]="'center'"></wj-flex-grid-column>
            </wj-flex-grid>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ruleModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-backdrop fade in"></div>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">{{modalTitle}} Model Spec Rule</h4>
            </div>
            <form #RuleForm="ngForm" *ngIf="ruleFormData">
                <div class="modal-body spec-rule-modal-body">
                    <!-- <part-modify #partModify [data]="partData"></part-modify> -->
                    <div class="a3-form-group">
                        <div class="form-group a3-input-group">
                            <label class="control-label">Model Name</label>
                            <input type="text" class="form-control" name="modelName" [(ngModel)]="ruleFormData.model_name" disabled>
                        </div>
                        <div class="form-group a3-input-group">
                            <label class="control-label">Rule Name
                                <span class="a3-asterisk">*</span>
                            </label>
                            <input type="text" class="form-control" id="ruleName" name="ruleName" [(ngModel)]="ruleFormData.rule_name" #ruleName="ngModel" required [disabled]="!rules?.length">
                            <!-- <div *ngIf="ruleName.errors && (ruleName.dirty || ruleName.touched)" class="alert alert-danger">
                                <div *ngIf="ruleName.errors.required">
                                    Rule Name is required!
                                </div>
                            </div> -->
                        </div>

                        <div *ngIf="ruleFormData.condition" class="form-group a3-input-group condition">
                            <label class="control-label">Condition</label>
                            <table>
                                <thead>
                                    <th class='filter_fieldname'>Paramter</th>
                                    <th class='filter_function'>Operand</th>
                                    <th class='filter_value'>Value</th>
                                    <th class='filter_btn'></th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let condition of ruleFormData.condition;let i=index">
                                        <td class="param-name">
                                                <!-- <select class='form-control' id="paramName{{i}}" name="paramName{{i}}" [ngClass]="{'has-error': !valid}" [(ngModel)]="condition.param_name" #paramName="ngModel" required> -->
                                            <select class='form-control' id="paramName{{i}}" name="paramName{{i}}" [(ngModel)]="condition.param_name" #paramName="ngModel" required>
                                                <option *ngFor="let parameter of editParameters" [ngValue]="parameter.param_name">{{parameter.param_name}}</option>
                                            </select>
                                            <!-- <div *ngIf="paramName.errors && (paramName.dirty || paramName.touched)" class="alert alert-danger">
                                                <div *ngIf="paramName.errors.required">
                                                    Parameter Name is required!
                                                </div>
                                            </div> -->
                                        </td>
                                        <td class="param-operand">
                                            <select class='form-control' id="operand{{i}}" name="operand{{i}}" [(ngModel)]="condition.operand" #operand="ngModel" required>
                                                <option *ngFor="let operand of operands" [ngValue]="operand.display">{{operand.display}}</option>
                                            </select>
                                            <!-- <div *ngIf="operand.errors && (operand.dirty || operand.touched)" class="alert alert-danger">
                                                <div *ngIf="operand.errors.required">
                                                    Operand is required!
                                                </div>
                                            </div> -->
                                        </td>
                                        <td class="param-value">
                                            <input type='text' class='form-control' id="value{{i}}" name="value{{i}}" [(ngModel)]="condition.param_value" #value="ngModel" required>
                                            <!-- <div *ngIf="value.errors && (value.dirty || value.touched)" class="alert alert-danger">
                                                <div *ngIf="value.errors.required">
                                                    Value is required!
                                                </div>
                                            </div> -->
                                        </td>
                                        <td *ngIf="i !== 0" class="remove">
                                            <span (click)="removeCondition(i)" class="glyphicon glyphicon-minus rollover" aria-hidden="true"></span>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="5" class="btnAddFilter">
                                            <span (click)="addCondition()" class="glyphicon glyphicon-plus rollover" aria-hidden="true"></span>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="form-group a3-input-group parameter-list" *ngIf="ruleFormData.parameter">
                            <label class="control-label">Parameter List</label>
                            <wj-flex-grid #ParamGrid
                                [itemsSource]="editParameters" 
                                [selectionMode]="'Row'" 
                                [headersVisibility]="'Column'">
                                <!-- <wj-flex-grid-filter #filter></wj-flex-grid-filter> -->
                                <wj-flex-grid-column [width]="'*'" [header]="'Parameter'" [binding]="'param_name'" [isReadOnly]="true"></wj-flex-grid-column>
                                <wj-flex-grid-column [width]="'*'" [header]="'Alarm'" [binding]="'upper_alarm_spec'" [dataType]="'Number'"></wj-flex-grid-column>
                                <wj-flex-grid-column [width]="'*'" [header]="'Warning'" [binding]="'upper_warning_spec'" [dataType]="'Number'"></wj-flex-grid-column>
                                <wj-flex-grid-column [width]="'*'" [header]="'Used'" [binding]="'used_yn'"></wj-flex-grid-column>
                            </wj-flex-grid>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" (click)="RuleForm.form.reset(); closeModal();">Close</button>
                    <button *ngIf="rules?.length" type="button" class="btn btn-primary" [disabled]="!RuleForm.form.valid" (click)="saveRule(RuleForm)">Apply</button>
                    <button *ngIf="!rules?.length" type="button" class="btn btn-primary" (click)="saveRule(RuleForm)">Apply</button>
                </div>
            </form>

        </div>
    </div>
</div>