<div class="spec-rule-container">
    <div class="spec-rule-header clearfix" style="">
        <div class="fab-selector">
            <label for="plant">Fab</label>
            <select class="form-control" [(ngModel)]="selectedPlant" (ngModelChange)="changeSelectedPlant($event)">
                <option *ngFor="let plant of plants" [ngValue]="plant" [selected]="plant.fabId === selectedPlant.fabId">
                    {{plant.fabName}}
                </option>
            </select>
        </div>
        <div class="model-seletor">
            <label for="model">Model</label>
            <select class="form-control" [(ngModel)]="selectedModel" (ngModelChange)="changeSelectedModel($event)">
                <option *ngFor="let model of models" [ngValue]="model" [selected]="model.model_name === selectedModel.model_name">
                    {{model.model_name}}
                </option>
            </select>
        </div>
        <div class="btn-group">
          <button class="btn btn-default" type="button" (click)="controlRule(STATUS.DELETE)">Delete</button>
          <button class="btn btn-default" type="button" (click)="controlRule(STATUS.MODIFY)">Modify</button>
          <button class="btn btn-default" type="button" (click)="controlRule(STATUS.CREATE)">Create</button>
        </div>
    </div>
    <div class="spec-rule-content">
        <div class="rule-list">
            <wj-flex-grid #WijmoGridInstance 
                [itemsSource]="rules" 
                [allowDragging]="'None'" 
                [isReadOnly]="true" 
                [selectionMode]="'Row'"
                [headersVisibility]="'Column'" 
                (selectionChanged)="selectRow(WijmoGridInstance)">
                <!-- <wj-flex-grid-filter #filter></wj-flex-grid-filter> -->
                <wj-flex-grid-column [width]="'*'" [header]="'Rule Name'" [binding]="'rule_name'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Condition'" [binding]="'expression'" [align]="'center'"></wj-flex-grid-column>
            </wj-flex-grid>
        </div>
        <div class="parameter-list">
            <wj-flex-grid 
                [itemsSource]="parametersByRule" 
                [allowDragging]="'None'" 
                [isReadOnly]="true" 
                [selectionMode]="'Row'"
                [headersVisibility]="'Column'">
                <!-- <wj-flex-grid-filter #filter></wj-flex-grid-filter> -->
                <wj-flex-grid-column [width]="'*'" [header]="'Parameter'" [binding]="'param_name'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Alarm'" [binding]="'alarm_spec'" [align]="'center'"></wj-flex-grid-column>
                <wj-flex-grid-column [width]="'*'" [header]="'Warning'" [binding]="'warning_spec'" [align]="'center'"></wj-flex-grid-column>
                <!-- <wj-flex-grid-column [width]="'*'" [header]="'Used'" [binding]="''" [align]="'center'">
                    <ng-template wjFlexGridCellTemplate [cellType]="'Cell'" let-row="row" let-item="item">
                        <input type="checkbox" [checked]="item.used" disabled/>
                    </ng-template>
                </wj-flex-grid-column> -->
            </wj-flex-grid>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ruleModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="myModalLabel">{{modalTitle}} Spec Rule</h4>
        </div>
        <form #RuleForm="ngForm">
          <div class="modal-body spec-rule-modal-body">
            <!-- <part-modify #partModify [data]="partData"></part-modify> -->
            <div class="a3-form-group" *ngIf="ruleFormData">
              <div class="form-group a3-input-group">
                <label class="control-label">Rule Name
                    <span class="a3-asterisk">*</span>
                </label>
                <input type="text" class="form-control" name="ruleName" [(ngModel)]="ruleFormData.rule_name">
              </div>

              <div class="condition">
                <label>Condition</label>
                <table>
                    <thead>
                        <th class='filter_fieldname'>Paramter</th>
                        <th class='filter_function'>Operand</th>
                        <th class='filter_value'>Value</th>
                        <th class='filter_btn'></th>
                    </thead>
                    <tbody>
                        <tr *ngFor="let condition of ruleFormData.condition;let i=index">
                            <td class="param-name">
                                <select class='form-control' name="paramName{{i}}" [(ngModel)]="condition.param_name">
                                    <option *ngFor="let parameter of parametersByRule" [ngValue]="parameter.param_name">{{parameter.param_name}}</option>
                                </select>
                            </td>
                            <td class="param-operand">
                                <select id="field{{i}}" class='form-control' name="operand{{i}}" [(ngModel)]="condition.operand">
                                    <option *ngFor="let operand of operands" [ngValue]="operand.display">{{operand.display}}</option>
                                </select>
                            </td>
                            <td class="param-value">
                                <input type='text' class='form-control' name="value{{i}}" [(ngModel)]="condition.param_value" required #value{{i}}="ngModel">
                            </td>
                            <td *ngIf="i !== 0" class="remove">
                                <span (click)="removeCondition(i)" class="glyphicon glyphicon-minus rollover" aria-hidden="true"></span>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" class="btnAddFilter">
                                <span (click)="addCondition()" class="glyphicon glyphicon-plus rollover" aria-hidden="true"></span>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>

              <!-- <div class="form-group a3-input-group">
                <label class="control-label">Parameter
                  <span class="a3-asterisk">*</span>
                </label>
                <select class="form-control" [(ngModel)]="ruleData.param_name" name="paramName" required #paramName="ngModel">
                  <option *ngFor="let parameter of parameters" [ngValue]="parameter.param_name">{{parameter.param_name}}</option>
                </select>
                <div *ngIf="paramName.errors && (paramName.dirty || paramName.touched)" class="alert alert-danger">
                  <div [hidden]="!paramName.errors.required">
                    Parameter is required!
                  </div>
                </div>
              </div>

              <div class="form-group a3-input-group">
                <label class="control-label">Operation
                  <span class="a3-asterisk">*</span>
                </label>
                <select class="form-control" [(ngModel)]="ruleData.operands" name="partsTypeCd" required #partsTypeCD="ngModel">
                  <option *ngFor="let partType of partTypes" [ngValue]="partType.parts_type_cd">{{partType.name}}</option>
                </select>
                <div *ngIf="partsTypeCD.errors && (partsTypeCD.dirty || partsTypeCD.touched)" class="alert alert-danger">
                  <div [hidden]="!partsTypeCD.errors.required">
                    Type is required!
                  </div>
                </div>
              </div>

              <div class="form-group a3-input-group">
                <label class="control-label">Value
                  <span class="a3-asterisk">*</span>
                </label>
                <select class="form-control" [(ngModel)]="partData.parts_type_cd" name="partsTypeCd" required #partsTypeCD="ngModel">
                  <option *ngFor="let partType of partTypes" [ngValue]="partType.parts_type_cd">{{partType.name}}</option>
                </select>
                <div *ngIf="partsTypeCD.errors && (partsTypeCD.dirty || partsTypeCD.touched)" class="alert alert-danger">
                  <div [hidden]="!partsTypeCD.errors.required">
                    Type is required!
                  </div>
                </div>
              </div> -->

              <div class="parameter-list" *ngIf="ruleFormData.parameter">
                <label>Parameter List</label>
                <wj-flex-grid #WijmoGridInstance 
                    [itemsSource]="ruleFormData.parameter" 
                    [selectionMode]="'Row'" 
                    [isReadOnly]="true"
                    [headersVisibility]="'Column'">
                  <wj-flex-grid-filter #filter></wj-flex-grid-filter>
                  <wj-flex-grid-column [width]="'*'" [header]="'Parameter'" [binding]="'param_name'"></wj-flex-grid-column>
                  <wj-flex-grid-column [width]="'*'" [header]="'Alarm'" [binding]="'alarm_spec'"></wj-flex-grid-column>
                  <wj-flex-grid-column [width]="'*'" [header]="'Warning'" [binding]="'warning_spec'"></wj-flex-grid-column>
                </wj-flex-grid>
              </div>
            </div>
  
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" (click)="RuleForm.form.reset(); closeModal();">Close</button>
            <button type="button" class="btn btn-primary" [disabled]="!RuleForm.form.valid" (click)="saveRule(RuleForm)">Apply</button>
          </div>
        </form>
  
      </div>
    </div>
  </div>